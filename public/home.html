<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Demonlist Ha Tinh - Home</title>
  <link href="https://fonts.googleapis.com/css2?family=Rubik&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: 'Rubik', sans-serif;
      background: linear-gradient(to bottom right, #1e1e2f, #2c2c3c);
      color: white;
    }

    nav {
      background-color: #111;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1em;
    }

    .nav-title {
      font-weight: bold;
      font-size: 1.5em;
    }

    .nav-links {
      display: flex;
      gap: 1em;
    }

    .nav-links a {
      color: white;
      text-decoration: none;
    }

    .hamburger {
      display: none;
      flex-direction: column;
      cursor: pointer;
    }

    .bar {
      width: 25px;
      height: 3px;
      background-color: white;
      margin: 4px 0;
    }

    @media (max-width: 600px) {
      .nav-links {
        display: none;
        flex-direction: column;
        width: 100%;
        background-color: #222;
        position: absolute;
        top: 60px;
        left: 0;
      }

      .nav-links.show {
        display: flex;
      }

      .hamburger {
        display: flex;
      }
    }

    .container {
      max-width: 800px;
      margin: 2em auto;
      padding: 1em;
      background-color: #2c2c3c;
      border-radius: 8px;
    }

    h1, h2 {
      text-align: center;
    }

    .level-box {
      background-color: #444;
      padding: 1em;
      margin: 1em 0;
      border-radius: 6px;
    }

    #add-level-section {
      margin-top: 2em;
    }

    input {
      width: 100%;
      padding: 8px;
      margin: 6px 0;
      border: none;
      border-radius: 4px;
    }

    button {
      padding: 10px 20px;
      background-color: #4caf50;
      border: none;
      color: white;
      border-radius: 4px;
      cursor: pointer;
    }

    #add-status {
      margin-top: 10px;
      color: #ffa;
    }
  </style>
</head>
<body>
  <nav>
    <div class="nav-title">Demonlist Ha Tinh</div>
    <div class="hamburger" onclick="toggleMenu()">
      <div class="bar"></div><div class="bar"></div><div class="bar"></div>
    </div>
    <div class="nav-links" id="nav-links">
      <a href="home.html">Home</a>
      <a href="leaderboard.html">Leaderboard</a>
    </div>
  </nav>

  <div class="container">
    <h1>Chào mừng trở lại!</h1>

    <h2>Extreme Demon List</h2>
    <div id="level-list">
      <!-- Danh sách level sẽ được render tại đây -->
    </div>

    <!-- Khu vực thêm level (chỉ hiện với admin) -->
    <div id="add-level-section">
      <h2>Thêm level mới</h2>
      <input type="text" id="level-name" placeholder="Tên level">
      <input type="number" id="level-points" placeholder="Điểm">
      <input type="text" id="level-video" placeholder="Link video">
      <button onclick="addLevel()">Thêm</button>
      <p id="add-status"></p>
    </div>
  </div>

  <script type="module">
    const SUPABASE_URL = "https://demonlist-ha-tinh.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRlbW9ubGlzdC1oYS10aW5oIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjczNzIwMTUsImV4cCI6MjA0Mjk0ODAxNX0.SOVk2pqy3yrD_ZMPeIp9oF5HTyvdlnUuZt3e3tV0RrU";
    const ADMIN_EMAILS = ['lacvn@example.com'];

    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";
    const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

    const userEmail = localStorage.getItem('user_email');
    const addSection = document.getElementById('add-level-section');

    if (!ADMIN_EMAILS.includes(userEmail)) {
      addSection.style.display = 'none';
    }

    async function loadLevels() {
      const { data, error } = await supabase.from('levels').select('*').order('points', { ascending: false });
      const list = document.getElementById('level-list');
      if (data && data.length > 0) {
        list.innerHTML = data.map(level => `
          <div class="level-box">
            <strong>${level.name}</strong> - ${level.points} điểm
            <br>
            <a href="${level.video}" target="_blank">Xem video</a>
          </div>
        `).join('');
      } else {
        list.innerHTML = '<p>Chưa có level nào.</p>';
      }
    }

    loadLevels();

    window.addLevel = async function () {
      if (!ADMIN_EMAILS.includes(userEmail)) {
        document.getElementById('add-status').textContent = 'Bạn không có quyền thêm level!';
        return;
      }

      const name = document.getElementById('level-name').value;
      const points = parseInt(document.getElementById('level-points').value);
      const video = document.getElementById('level-video').value;

      if (!name || !points || !video) {
        document.getElementById('add-status').textContent = 'Vui lòng điền đầy đủ thông tin.';
        return;
      }

      const { error } = await supabase.from('levels').insert([{ name, points, video }]);
      if (error) {
        document.getElementById('add-status').textContent = 'Lỗi: ' + error.message;
      } else {
        document.getElementById('add-status').textContent = 'Thêm thành công!';
        document.getElementById('level-name').value = '';
        document.getElementById('level-points').value = '';
        document.getElementById('level-video').value = '';
        loadLevels();
      }
    };

    window.toggleMenu = function () {
      document.getElementById("nav-links").classList.toggle("show");
    };
  </script>
</body>
</html>
