<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Demonlist Ha Tinh - Home</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #121212;
      color: white;
      margin: 20px;
    }
    .level-box {
      border: 1px solid #444;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 8px;
      background-color: #1e1e1e;
    }
    .log {
      background-color: #2a2a2a;
      color: #ff4444;
      padding: 10px;
      margin-top: 20px;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <h1>Demonlist Ha Tinh - Home</h1>
  <div id="levels-container"></div>
  <div class="log" id="log"></div>

  <script>
    const supabaseUrl = 'https://demonlist-ha-tinh.supabase.co'
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlkeHBvbW1jZWlucXNpb2JpZG9tIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQwNTA3NzMsImV4cCI6MjA2OTYyNjc3M30.MxkN3YMrEl-sZGQ7FZgUnF-Cid-s027vT660dMyzTNo'
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey)

    const log = (msg) => {
      document.getElementById('log').innerText += msg + '\n'
    }

    async function loadLevels() {
      log('🔍 Đang tải level từ Supabase...')

      const { data, error } = await supabase
        .from('levels')
        .select('*')
        .order('points', { ascending: false })

      if (error) {
        log('❌ Lỗi khi tải dữ liệu: ' + error.message)
        return
      }

      if (!data || data.length === 0) {
        log('⚠️ Không có level nào được tìm thấy.')
        return
      }

      log(`✅ Tải thành công ${data.length} level:`)

      const container = document.getElementById('levels-container')
      data.forEach(level => {
        log(`- ${level.name} (${level.points} điểm)`)
        const box = document.createElement('div')
        box.className = 'level-box'
        box.innerHTML = `
          <h3>${level.name}</h3>
          <p><strong>Creator:</strong> ${level.creator}</p>
          <p><strong>Points:</strong> ${level.points}</p>
          <p><strong>ID:</strong> ${level.id}</p>
          ${level.video ? `<iframe width="320" height="180" src="https://www.youtube.com/embed/${extractYouTubeID(level.video)}" frameborder="0" allowfullscreen></iframe>` : ''}
        `
        container.appendChild(box)
      })
    }

    function extractYouTubeID(url) {
      const match = url.match(/(?:youtu\.be\/|youtube\.com\/(?:watch\?v=|embed\/))([^\s&]+)/)
      return match ? match[1] : ''
    }

    loadLevels()
  </script>
</body>
</html>
